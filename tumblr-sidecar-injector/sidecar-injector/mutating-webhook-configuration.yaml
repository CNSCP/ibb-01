apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: "tumblr-sidecar-injector-webhook"
  labels:
    app: k8s-sidecar-injector
    track: prod
webhooks:
- name: "injector.tumblr.com"
  failurePolicy: "Ignore" # we fail "open" if the webhook is down hard
  sideEffects: None
  admissionReviewVersions: 
    - v1
  rules:
  - operations: [ "CREATE" ]
    apiGroups: [""]
    apiVersions: ["v1"]
    resources: ["pods"]
  clientConfig:
    # https://github.com/kubernetes/kubernetes/blob/v1.10.0-beta.1/staging/src/k8s.io/api/admissionregistration/v1beta1/types.go#L218
    # note: k8s is smart enough to use 443 or the only exposed port on the service
    # note: this requires the service to serve TLS directly (not thru ingress)
    service:
      name: "k8s-sidecar-injector-prod"
      namespace: "kube-system"
      path: "/mutate"   # what /url/slug to send requests at
    # See README.md for how this was generated!
    caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZwVENDQTQwQ0ZCdVpQdzBRdStQWEV3VCs3NEVyamNRRGJWRmdNQTBHQ1NxR1NJYjNEUUVCQ3dVQU1JR04KTVFzd0NRWURWUVFHRXdKVlV6RVJNQThHQTFVRUNBd0lUbVYzSUZsdmNtc3hGakFVQmdOVkJBY01EVTVsZHlCWgpiM0pySUVOcGRIa3hEREFLQmdOVkJBb01BMGxDUWpFZ01CNEdBMVVFQXd3WGF6aHpMWE5wWkdWallYSXRhVzVxClpXTjBiM0l0UTBFeEl6QWhCZ2txaGtpRzl3MEJDUUVXRkdGa2JXbHVRR2xpWW5CeWIycGxZM1F1WTI5dE1DQVgKRFRJek1URXhOVEF6TlRneE1Gb1lEelEzTmpFeE1ERXhNRE0xT0RFd1dqQ0JqVEVMTUFrR0ExVUVCaE1DVlZNeApFVEFQQmdOVkJBZ01DRTVsZHlCWmIzSnJNUll3RkFZRFZRUUhEQTFPWlhjZ1dXOXlheUJEYVhSNU1Rd3dDZ1lEClZRUUtEQU5KUWtJeElEQWVCZ05WQkFNTUYyczRjeTF6YVdSbFkyRnlMV2x1YW1WamRHOXlMVU5CTVNNd0lRWUoKS29aSWh2Y05BUWtCRmhSaFpHMXBia0JwWW1Kd2NtOXFaV04wTG1OdmJUQ0NBaUl3RFFZSktvWklodmNOQVFFQgpCUUFEZ2dJUEFEQ0NBZ29DZ2dJQkFLaDFWRUIyWHVvSndQSTJLTHQxRnByK2xORDV1SHBOWTBPUk0xZk9vRkk1CkF2WEEwVVFtLzltUWVxYkFiZ1BnT2tsK1gxcUFoZW5mNUk2UjN2VjJYTkhFV01MN2RETzBUS1FOZHZUYVkvQW4KeW1IbHlXMkdIWkI3OUpNMDQ2cUkrOEVHZHVHOHhnbzVTTmhoNUU4S1c3eU0rbGVqWDNXQWcwbnZzMlRQcmtSZQoxRXNEMDlIdnl6Z2h4QmdLdVI2RWhhNmt4VTlnMWN0cXk5Y005WHRWam1RYzNZUTJ1TjJnRVAxbW5lSWRDdmowClJXQTZaWUZDSmsveCtMSTkzZXlQUUplb0FsMHNnTWdIU0lsMEUxRldHek84ek5peW1ZYTZaQ09vWWRjRzdheGQKZGxwQzlsMGZUVGFjck1IZHRVa21wL0pBL2JlOEVUdTk2VzZ5OWtVLzNpMEo4Qk1LbnpTNmV3RXFnN2I5UjdNQwpzOU9YeHZqcmNWL0Y3RUNtSDUwbndLZytSYnk3WXBXYWh5SjFLZko0YlJyNitDUnhDdVY0MlNmNmYyWmxSL0pvCkRoTHNlMnZ3ZnpzYUU3ZzhCS1hhNFYrNldOUnpxV096VGVZdzJlRUtkZDVQMTY2Z1Vhdm1MR21IdE9vaDZXbXUKc1NHVHJtQmtkM0gxKzFma000VlE5RGZWZmhzNExtRmtFRVFMamdlU2lyWlpFL1FCaWxRZDlwVWU0bzhBYWhteQpsNUJZdEkzcGJWa3lvNFlxZkxqdnJtQ3RQZnJqQkdQa3llWXRiOUZlUThpQVJIU0ViYTcxdUZTWWducjRqQWFBCjh6WEFHVHRXdW9LRDNrNlJFVytDNGo4RU9GSzBGdGNlc09EZUpNUjNOWXZPNXhDT0E3Tm5oblNWZHhQZHo0Q2QKQWdNQkFBRXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnSUJBSWdURTF2RkZ2d2dURlZEZHc4WFhrN1NIVGgxc3F6dgpXU2Uwb2x1aHVTeUUrejhQVWlXUXZXYmJiNi90dTlrTXVkWEhGN1VVRlplNW5UeWQ3V0VreTNFNTVQbmRKWWRICjY3dlNhN1A3Zm9kUTU3MWJyb3RFc3JrMFd3c2YvdGphT293Z0VoYmhvVktxSjZldFdRKzRaUEtvaG9xQmVHeUYKOEQwM1MyRW1UWkVSWU56OUk0WmZuMTJKWWdxa2Fsa2EvNHNHc3RXRVNrVzRxNm1lM2VOZzZzd1FOaFc1aVpoYQoybkhUMG5mQlVMbWtKWGRMRzNjbXpaaVV2b3Q2S1N6MEJOc0ZQZEcvb0ltQjJlQjNmOVozOE5kazZ5SUhHOHJrCjFNMlltQ0I5c015ZENMMjJOb3FqbGxjU1ZETHJQUVJGOGhrSnNaQk1ZYmFLZmRUK2ZtUm1HNG1ndjA0aURoaXkKNTBha09CcXluWUxZSFl5aWNmc2tqUkp6d2pqOTVFQW5pamNsam9lK21Rdk50ZTdJRzZ5cmplRGtKeG5WclBxTwpFMXpVY3pFZDNNelJkcE1PYitkU2o2dXk1L3l1YWFrRUJ3YVphOVNOOXl4eHB3RkF1M0pucWl2ZDlzdU5Tb2x2CjJzY2Jra05kTE9jSVZiWEdnVGhlVHAzTlZQTkJacW5WQSt2eGxNWXJwQ1k1bDA4LzVxUkR0RDBVQ2ZGRFFGTlcKZWhXZG5NTVJHL0E0SFQvZmFFRjZWcGVRNGkxSlZiYm9PWk5lQU1ESldhc2h6dGUrcElwZWJmdC9lWGp5UlpZMwpLb0pJdnlNeEJvS3ljcnlKR3k0MlJwcmRjQUtyS1d2Z2xZRFBnWGRzOTFYeEJTS2xjTUkreW9WeUp3dUFBMCtNCjRKZVJZQytUVXErMAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="
