apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  name: "ibb-ktunnel-sidecar-injector"
  labels:
    com.ibbproject/cfg: ibb-ktunnel-sidecar-injector
webhooks:
- name: "ktunnel.injector.ibbproject.com"
  failurePolicy: "Ignore" # we fail "open" if the webhook is down hard
  # failurePolicy: "Fail"
  sideEffects: None
  admissionReviewVersions: 
    - v1
  rules:
  - operations: [ "CREATE" ]
    apiGroups: [""]
    apiVersions: ["v1"]
    resources: ["pods"]
  clientConfig:
    # https://github.com/kubernetes/kubernetes/blob/v1.10.0-beta.1/staging/src/k8s.io/api/admissionregistration/v1beta1/types.go#L218
    # note: k8s is smart enough to use 443 or the only exposed port on the service
    # note: this requires the service to serve TLS directly (not thru ingress)
    service:
      name: "ibb-ktunnel-sidecar-injector"
      namespace: "kube-system"
      path: "/mutate"   # what /url/slug to send requests at
    # See README.md for how this was generated!
    caBundle: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZyekNDQTVjQ0ZBSGdpcktwQjBCNk9wOElOY3owWDZWR3VnNlFNQTBHQ1NxR1NJYjNEUUVCQ3dVQU1JR1MKTVFzd0NRWURWUVFHRXdKVlV6RVJNQThHQTFVRUNBd0lUbVYzSUZsdmNtc3hGakFVQmdOVkJBY01EVTVsZHlCWgpiM0pySUVOcGRIa3hEREFLQmdOVkJBb01BMGxDUWpFbE1DTUdBMVVFQXd3Y2FXSmlMV3QwZFc1dVpXd3RjMmxrClpXTmhjaTFwYm1wbFkzUnZjakVqTUNFR0NTcUdTSWIzRFFFSkFSWVVZV1J0YVc1QWFXSmljSEp2YW1WamRDNWoKYjIwd0lCY05Nak14TWpBM01EUXdNREU1V2hnUE5EYzJNVEV4TURJd05EQXdNVGxhTUlHU01Rc3dDUVlEVlFRRwpFd0pWVXpFUk1BOEdBMVVFQ0F3SVRtVjNJRmx2Y21zeEZqQVVCZ05WQkFjTURVNWxkeUJaYjNKcklFTnBkSGt4CkREQUtCZ05WQkFvTUEwbENRakVsTUNNR0ExVUVBd3djYVdKaUxXdDBkVzV1Wld3dGMybGtaV05oY2kxcGJtcGwKWTNSdmNqRWpNQ0VHQ1NxR1NJYjNEUUVKQVJZVVlXUnRhVzVBYVdKaWNISnZhbVZqZEM1amIyMHdnZ0lpTUEwRwpDU3FHU0liM0RRRUJBUVVBQTRJQ0R3QXdnZ0lLQW9JQ0FRQ2pOWHJDUWFuOG1wL1pwMFlWMjdFMEhOSDBlOUJuCkxFZEV2clFoTXk0UlFHcFhLMHdLZGR0cDEzUzNZR08reHpFMVJ1ZUh3TGZ6OFNwcUVUTnNTTjFqbU1ydXRUTnQKcVh1Z05sTVI1VUx3bWlsQnNhUnY2Y2M4ODJYVlU0b3dqRHRDMFlxQkd1bEN4WEEySjRSb21ySG5JSDh3QnFOdQo3OWF0R0oyRExNMVdxK0VKbU9YQjhWSXU0UFlFMWZicVdyMGhUakl0d0JoNVJ0ZDFGUFcvMUk2Y3VsWFJvdUxaCmJFeUgxN3k5RHZZY3FGQk1yNXpJU2JlK09nNTdLRkFmYjcvblZHS0liYUVmYVBKdlpMck8raEVTWUVqK1VhemgKTlRpSlNMczFEQm5iVDBML2dCOU9WbXZOSGI2RThSay9xbDBUVVNUM2IyY1NNdjg4M0pMdXZ6eFFaMmVCa25MUAo4ZTU2MmNOK01xRnpGQmtpKzhRSHFaUlFnSEZPQ2VaWGk1cjd5aHd1T05XWEpzVGVqOXVFTzArUlVGWUZySTNPCkJCQ3RweXhFamRoS2lKT2pLU2NIZWJCY1prT1Fsank2VnoyREdET1hmeHpzSFJ6bHNkbmttZW1EY2JZcnRTbjgKdGhZeTlyZzJaNXhWV0hZMThDemdBRFk0enFFK1BBb1plMzRmbDNPTndxeGJEcmk2QWRjakZxQkZuekJBNEZQMgpFaHBzVGtwUHdpUm9HWXdhSiticjFCcDlFVjdqRmVudVQ0THZuRWxXT1M2LzRuR1FlSDZBUHlpc29rSTFOOW45Cm50bGVVTTdpMFB2WVFiRzdvU2E4Ymp4dHJKV01QbG8wU2pCY2xOekhnNHQ1aEJiczVxemtuTmYxbUp2THowQW8KSm14aWJoVHc2ZmxMdlFJREFRQUJNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUNBUUJTK3FuWGRiZnA0cE55ZndRbgpXYUR6bzFPV0VJKzJNaXV1T1JBRnRtMmJHWHowbnJXWnNXangrdUI2OEpMcXdCK0NCcFJjNmJwZk1UeFRtZGYwClVSOFpDalVCY3RWUTJxMjUwalZma3dmVzhOSWxYNFdZaXBYTDU3Mk5YYmozVnBCMGt2cERMYkRzbjM1V0ZtdmcKeG5WbWlZZENTbUk5VjVCYkNhTE5XQVBwRjVLWi9wbkVPZlc1K3pEZ00vUUpCMXQzMjZYVitHT1JwcU5nbGF0NQpTR0xseUttNVRXb2VJQW5id0g2KzZMSjZPOEZLLzRlS2ZXbzlGZExOMS9mbVdZelBJb1pvZ2d0ZkdacllOajFWCnhZeklEOERFZG9oWml1Nnk3VWlTbEhvR2MyYVR1Rm5jcExEMTVPT3hiZDRZVWhCVTBmQ1J4ZGF2OUlwaythdFUKQVZqNzdpbFJRYTlGWWIzcXBadEtIMnJKNWV0ZDlWM2JwL2VhRWtYYTYydE8vdTBiWUxWbUtYVHdKK1lTQjd6cgpaREhheFpJQTRMUEhOQWdnNjNCUnhEeHpYUTF4ZzYwMTRvMmZaaU5xdEhvR0FHeEtLN09NODNTT1dGdjk5MXNRCklDTVJwUTcvVmJhQW56djJ5NjhsVVNScldYQTNWd3A2OGVGMHVTMjR4ZUhlT1Y4TVlORDFtNzRsaTZnZ0dzTHEKemtLVG9pUnRzL2NBSVU3UU5sZTd4TzNJekRCMGtuUzlrR09LdkNCWVpXdUlYZjlsNC95amdtTVI0MUpIT083SgpXRUFJZXNqcDNXWkUzMUg5MHVZZTNESWRJc3l5OTMvb3NHci9GYk9PbXlxLzUwSHV0SW1mV1NINFYyWnNLTXRBCnBCZXpWVFRHeXg3aHdvVGJOQkpzUWpnR2N3PT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
